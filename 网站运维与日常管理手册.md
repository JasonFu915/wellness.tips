# 🛠️ 网站运维与日常管理手册 (Operations Manual)

本文档旨在帮助网站管理员进行日常的内容更新、维护和故障修复。

---

## 📦 一、环境准备

在执行任何自动化脚本之前，请确保本地环境已准备就绪。

### 1. 安装依赖
确保已安装 Python 3.8+ 和 Node.js 18+。

```bash
# 安装 Python 依赖
pip install -r scripts/requirements.txt

# 安装 Node.js 依赖
npm install
```

### 2. 配置环境变量
确保系统环境变量或 `.env` 文件中包含以下密钥（如需调用 AI 或图片 API）：

- `DASHSCOPE_API_KEY`: 阿里云百炼 API Key (用于生成文章)
- `UNSPLASH_ACCESS_KEY`: Unsplash API Key (用于获取封面图)

---

## 🖼️ 二、插图自动修复 (核心功能)

如果你发现网站上某些文章的封面图为空，或者想批量为旧文章补充封面图，请使用此脚本。

### 脚本说明
`scripts/migrate_covers.py` 是一个智能修复工具，具备以下功能：
1.  **自动检测**：扫描所有语言的文章，找出 `coverImage` 字段缺失或为空的文件。
2.  **智能匹配**：根据文章英文标题，调用 Unsplash API 搜索匹配的高清图片。
3.  **自动回退**：如果 API 调用失败或无结果，自动使用本地默认 SVG 封面 (`/images/{lang}/cover.svg`)，保障页面不崩坏。
4.  **批量同步**：确保同一篇文章的所有语言版本使用相同的封面图。

### 如何运行

在项目根目录下，打开终端执行：

```bash
python scripts/migrate_covers.py
```

**运行效果示例：**
```text
Scanning 50 article groups for missing covers...
Fetching Unsplash image for query: Sleep Benefits
-> Saved content/en/sleep-benefits.md
-> Saved content/zh/sleep-benefits.md
...
Updating empty cover for: content/fr/old-post.md (Using local default)
-> Saved content/fr/old-post.md
```

---

## 📝 三、日常内容生成

通常此步骤由 GitHub Actions 自动触发，但你也可以手动运行以立即生成内容。

### 运行生成脚本

```bash
python scripts/generate_daily_tip.py
```

*   默认每次生成 2 篇新文章（每篇含 5 种语言版本）。
*   生成后，你需要手动提交代码到 GitHub 才会发布。

```bash
git add .
git commit -m "feat: manual content generation"
git push
```

---

## 💻 四、本地开发与预览

在修改代码或样式后，建议在本地预览效果。

```bash
# 启动开发服务器
npm run dev
```

访问 [http://localhost:3000](http://localhost:3000) 查看网站。

---

## ⚠️ 五、常见问题排查

### 1. 脚本报错 `ModuleNotFoundError`
*   **原因**：Python 依赖未安装。
*   **解决**：运行 `pip install -r scripts/requirements.txt`。

### 2. Unsplash 图片获取失败
*   **原因**：API Key 无效或超限，或者网络问题。
*   **现象**：脚本会提示 `API Error` 或 `Using default local covers`。
*   **解决**：这是正常容错机制。如需恢复 API 图片，请检查环境变量 `UNSPLASH_ACCESS_KEY`。

### 3. 文章生成后 Sitemap 未更新
*   **说明**：本项目使用动态 Sitemap (`app/sitemap.js`)。
*   **解决**：无需手动更新。只要 Markdown 文件存在，访问 `/sitemap.xml` 时会自动包含新文章。
